<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symptom Checker - Rural AI Health</title>
    
    <!-- TensorFlow.js Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header {
            margin-bottom: 30px;
            border-bottom: 3px solid #2E7D32;
            padding-bottom: 15px;
        }

        .header h1 {
            color: #2E7D32;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        .disclaimer {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 12px;
            color: #856404;
        }

        .symptoms-section {
            margin-bottom: 30px;
        }

        .symptoms-section h2 {
            font-size: 18px;
            color: #2E7D32;
            margin-bottom: 15px;
        }

        .symptom-category {
            margin-bottom: 20px;
        }

        .symptom-category h3 {
            font-size: 14px;
            color: #1B5E20;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .symptoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .symptom-checkbox {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .symptom-checkbox:hover {
            border-color: #2E7D32;
            background: #f0f8f5;
        }

        .symptom-checkbox input[type="checkbox"] {
            margin-right: 10px;
            cursor: pointer;
            width: 18px;
            height: 18px;
            accent-color: #2E7D32;
        }

        .symptom-checkbox label {
            flex: 1;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .symptom-checkbox input[type="checkbox"]:checked + label {
            color: #2E7D32;
            font-weight: 600;
        }

        .selected-symptoms {
            margin-top: 20px;
            padding: 15px;
            background: #E8F5E9;
            border-radius: 6px;
            border-left: 4px solid #2E7D32;
        }

        .selected-symptoms h3 {
            color: #2E7D32;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .symptom-badge {
            display: inline-block;
            background: #2E7D32;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .symptom-badge .remove {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2E7D32;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #1B5E20;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }

        .btn-secondary {
            background: #E3F2FD;
            color: #2E7D32;
            border: 2px solid #2E7D32;
        }

        .btn-secondary:hover {
            background: #2E7D32;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* PHOTO UPLOAD SECTION */
        .photo-section {
            display: none;
            margin: 30px 0;
            padding: 20px;
            background: #E3F2FD;
            border-radius: 8px;
            border-left: 4px solid #2E7D32;
        }

        .photo-section h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .photo-section p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .file-input-wrapper {
            margin-bottom: 15px;
        }

        .file-input-wrapper input[type="file"] {
            display: block;
            margin-bottom: 15px;
            padding: 10px;
            border: 2px solid #2E7D32;
            border-radius: 6px;
            cursor: pointer;
        }

        .photo-preview-container {
            display: none;
            margin-bottom: 15px;
        }

        .photo-preview-container img {
            max-width: 250px;
            max-height: 250px;
            border-radius: 8px;
            border: 2px solid #2E7D32;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .photo-loading {
            display: none;
            text-align: center;
            margin: 15px 0;
            color: #2E7D32;
            font-weight: 600;
        }

        .photo-loading.spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .photo-analysis-result {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #2E7D32;
        }

        .photo-analysis-result h4 {
            color: #2E7D32;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .photo-analysis-result p {
            font-size: 13px;
            color: #333;
            margin: 5px 0;
        }

        .confidence-boost {
            margin-top: 10px;
            padding: 10px;
            background: #C8E6C9;
            border-radius: 4px;
            color: #1B5E20;
            font-weight: 600;
            font-size: 13px;
        }

        /* RESULTS SECTION */
        .results-section {
            margin-top: 30px;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .results-section h2 {
            color: #2E7D32;
            font-size: 20px;
            margin-bottom: 20px;
            border-bottom: 3px solid #2E7D32;
            padding-bottom: 10px;
        }

        .disease-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .disease-card:hover {
            border-color: #2E7D32;
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.2);
        }

        .disease-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .disease-name {
            font-size: 18px;
            font-weight: 600;
            color: #1B5E20;
        }

        .confidence-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .confidence-high {
            background: #C8E6C9;
            color: #1B5E20;
        }

        .confidence-medium {
            background: #FFF9C4;
            color: #F57F17;
        }

        .confidence-low {
            background: #FFCCBC;
            color: #D84315;
        }

        .disease-urgency {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .urgency-high {
            background: #FFCDD2;
            color: #B71C1C;
        }

        .urgency-medium {
            background: #FFE0B2;
            color: #E65100;
        }

        .urgency-low {
            background: #E8F5E9;
            color: #1B5E20;
        }

        .disease-details {
            font-size: 14px;
            color: #666;
        }

        .disease-details h4 {
            color: #2E7D32;
            margin-top: 12px;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
        }

        .disease-details ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .disease-details li {
            margin-bottom: 6px;
            line-height: 1.5;
        }

        .photo-boost-indicator {
            display: inline-block;
            background: #C8E6C9;
            color: #1B5E20;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 11px;
            margin-left: 8px;
            font-weight: 600;
        }

        .error-message {
            display: none;
            background: #FFCDD2;
            color: #B71C1C;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #B71C1C;
        }

        .error-message.show {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2E7D32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @media (max-width: 768px) {
            .symptoms-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .disease-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ü©∫ Symptom Checker</h1>
            <p>Select your symptoms to get an AI-powered preliminary diagnosis</p>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            ‚ö†Ô∏è This is an AI-powered preliminary assessment tool and NOT a substitute for professional medical diagnosis. Always consult with a qualified doctor for accurate diagnosis and treatment. In case of emergency, call 108 or visit the nearest hospital.
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>

        <!-- Symptoms Section -->
        <div class="symptoms-section">
            <h2>Select Your Symptoms</h2>

            <!-- General Symptoms -->
            <div class="symptom-category">
                <h3>General</h3>
                <div class="symptoms-grid">
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="fever">
                        <label>üå°Ô∏è Fever</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="fatigue">
                        <label>üò¥ Fatigue</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="headache">
                        <label>ü§ï Headache</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="body_ache">
                        <label>üí™ Body Ache</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="weakness">
                        <label>‚ö†Ô∏è Weakness</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="chills">
                        <label>‚ùÑÔ∏è Chills</label>
                    </label>
                </div>
            </div>

            <!-- Respiratory -->
            <div class="symptom-category">
                <h3>Respiratory</h3>
                <div class="symptoms-grid">
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="cough">
                        <label>üò∑ Cough</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="sore_throat">
                        <label>üó£Ô∏è Sore Throat</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="runny_nose">
                        <label>üëÉ Runny Nose</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="difficulty_breathing">
                        <label>üòÆ‚Äçüí® Difficulty Breathing</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="chest_pain">
                        <label>üíî Chest Pain</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="nasal_congestion">
                        <label>ü§ß Nasal Congestion</label>
                    </label>
                </div>
            </div>

            <!-- Digestive -->
            <div class="symptom-category">
                <h3>Digestive</h3>
                <div class="symptoms-grid">
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="nausea">
                        <label>ü§¢ Nausea</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="vomiting">
                        <label>ü§Æ Vomiting</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="diarrhea">
                        <label>üöΩ Diarrhea</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="abdominal_pain">
                        <label>ü´ò Abdominal Pain</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="loss_of_appetite">
                        <label>üçΩÔ∏è Loss of Appetite</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="indigestion">
                        <label>üòñ Indigestion</label>
                    </label>
                </div>
            </div>

            <!-- Skin -->
            <div class="symptom-category">
                <h3>Skin</h3>
                <div class="symptoms-grid">
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="rash">
                        <label>üî¥ Rash</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="itching">
                        <label>ü§è Itching</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="skin_redness">
                        <label>üå∫ Skin Redness</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="blister">
                        <label>ü´ß Blister</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="wound">
                        <label>‚úÇÔ∏è Wound</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="swelling">
                        <label>üëµ Swelling</label>
                    </label>
                </div>
            </div>

            <!-- Neurological -->
            <div class="symptom-category">
                <h3>Neurological</h3>
                <div class="symptoms-grid">
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="dizziness">
                        <label>üåÄ Dizziness</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="confusion">
                        <label>üòï Confusion</label>
                    </label>
                    <label class="symptom-checkbox">
                        <input type="checkbox" class="symptom-check" value="muscle_cramps">
                        <label>ü¶µ Muscle Cramps</label>
                    </label>
                </div>
            </div>

            <!-- Selected Symptoms Display -->
            <div class="selected-symptoms" id="selectedSymptomsDisplay" style="display: none;">
                <h3>Selected Symptoms:</h3>
                <div id="symptomBadges"></div>
                <p style="margin-top: 10px; font-size: 13px; color: #555;"><span id="symptomCount">0</span> symptoms selected</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" id="analyzeBtn" disabled>
                Analyze Symptoms ‚Üí
            </button>
            <button class="btn btn-secondary" id="clearBtn">
                Clear Selection
            </button>
        </div>

        <!-- PHOTO UPLOAD SECTION -->
        <div class="photo-section" id="photoSection">
            <h3>üì∏ Upload Photo (Optional)</h3>
            <p>Upload a photo of the affected area (rash, wound, etc.) to improve diagnosis accuracy</p>
            
            <div class="file-input-wrapper">
                <input type="file" id="photoInput" accept="image/*">
            </div>
            
            <div class="photo-preview-container" id="previewContainer">
                <img id="photoPreview" alt="Selected photo">
            </div>
            
            <button class="btn btn-primary" id="analyzePhotoBtn" style="display: none;">
                ü§ñ Analyze Photo
            </button>
            
            <div class="photo-loading" id="photoLoadingSpinner">
                <div class="loading-spinner"></div>
                <p style="margin-top: 10px;">‚è≥ Analyzing photo... (5-10 seconds)</p>
            </div>
            
            <div class="photo-analysis-result" id="photoAnalysisResult">
                <h4>‚úì Photo Analysis Results:</h4>
                <div id="photoAnalysisText"></div>
            </div>
        </div>

        <!-- RESULTS SECTION -->
        <div class="results-section" id="resultsSection">
            <h2>Diagnosis Results</h2>
            <div id="diseaseResults"></div>
        </div>

        <!-- Navigation -->
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0; text-align: center;">
            <p style="font-size: 14px; color: #666; margin-bottom: 12px;">Ready to book an appointment?</p>
            <a href="appointments.html" class="btn btn-secondary">üìÖ Go to Appointments</a>
            <a href="patient-dashboard.html" class="btn btn-secondary" style="margin-left: 10px;">üìä Back to Dashboard</a>
        </div>
    </div>

    <script>
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let selectedSymptoms = [];
        let mobileNetModel = null;
        let photoAnalysisData = null;

        // ============================================
        // TENSORFLOW.JS INITIALIZATION
        // ============================================
        async function initializeTensorFlow() {
            try {
                console.log('Loading TensorFlow MobileNet model...');
                mobileNetModel = await mobilenet.load();
                console.log('‚úÖ TensorFlow ready');
            } catch (error) {
                console.error('‚ùå Failed to load TensorFlow:', error);
            }
        }

        window.addEventListener('load', initializeTensorFlow);

        // ============================================
        // SYMPTOM CHECKBOX HANDLING
        // ============================================
        function setupCheckboxListeners() {
            const checkboxes = document.querySelectorAll('.symptom-check');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (!selectedSymptoms.includes(this.value)) {
                            selectedSymptoms.push(this.value);
                        }
                    } else {
                        selectedSymptoms = selectedSymptoms.filter(s => s !== this.value);
                    }
                    updateSelectedDisplay();
                    onSymptomSelected();
                });
            });
        }

        function updateSelectedDisplay() {
            const display = document.getElementById('selectedSymptomsDisplay');
            const badges = document.getElementById('symptomBadges');
            const count = document.getElementById('symptomCount');
            const analyzeBtn = document.getElementById('analyzeBtn');

            if (selectedSymptoms.length > 0) {
                display.style.display = 'block';
                count.textContent = selectedSymptoms.length;

                badges.innerHTML = selectedSymptoms.map(symptom => `
                    <span class="symptom-badge">
                        ${symptom.replace(/_/g, ' ')}
                        <span class="remove" onclick="removeSymptom('${symptom}')">‚úï</span>
                    </span>
                `).join('');

                analyzeBtn.disabled = false;
            } else {
                display.style.display = 'none';
                analyzeBtn.disabled = true;
            }
        }

        function removeSymptom(symptom) {
            const checkbox = document.querySelector(`input[value="${symptom}"]`);
            if (checkbox) {
                checkbox.checked = false;
                checkbox.dispatchEvent(new Event('change'));
            }
        }

        function clearAll() {
            selectedSymptoms = [];
            document.querySelectorAll('.symptom-check').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedDisplay();
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('photoSection').style.display = 'none';
            photoAnalysisData = null;
            document.getElementById('photoInput').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('analyzePhotoBtn').style.display = 'none';
        }

        // ============================================
        // PHOTO SECTION VISIBILITY
        // ============================================
        function onSymptomSelected() {
            if (selectedSymptoms.length >= 2) {
                document.getElementById('photoSection').style.display = 'block';
            } else {
                document.getElementById('photoSection').style.display = 'none';
            }
        }

        // ============================================
        // PHOTO UPLOAD HANDLER
        // ============================================
        function setupPhotoUpload() {
            document.getElementById('photoInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('photoPreview').src = event.target.result;
                    document.getElementById('previewContainer').style.display = 'block';
                    document.getElementById('analyzePhotoBtn').style.display = 'block';
                    window.selectedPhotoFile = file;
                };
                reader.readAsDataURL(file);
            });
        }

        // ============================================
        // ANALYZE PHOTO WITH TENSORFLOW
        // ============================================
        function analyzePhotoWithTensorFlow() {
            if (!window.selectedPhotoFile) {
                showError('Please select a photo first');
                return;
            }

            if (!mobileNetModel) {
                showError('TensorFlow model not loaded. Please wait...');
                return;
            }

            document.getElementById('photoLoadingSpinner').style.display = 'block';
            document.getElementById('photoAnalysisResult').style.display = 'none';

            const img = new Image();
            img.onload = async () => {
                try {
                    const predictions = await mobileNetModel.classify(img, 3);
                    document.getElementById('photoLoadingSpinner').style.display = 'none';

                    const skinKeywords = ['rash', 'skin', 'wound', 'lesion', 'inflammation', 'dermatitis', 'sore', 'blister', 'ulcer'];
                    const foundCondition = predictions.some(p =>
                        skinKeywords.some(kw => p.className.toLowerCase().includes(kw))
                    );

                    let html = '<strong>Detected:</strong><br>';
                    predictions.forEach(p => {
                        html += `‚Ä¢ ${p.className}: ${Math.round(p.probability * 100)}%<br>`;
                    });

                    if (foundCondition) {
                        html += '<div class="confidence-boost">‚úì Skin condition confirmed! Confidence will be boosted by +10%</div>';
                        photoAnalysisData = { success: true, boost: 10 };
                    } else {
                        photoAnalysisData = { success: false, boost: 0 };
                    }

                    document.getElementById('photoAnalysisText').innerHTML = html;
                    document.getElementById('photoAnalysisResult').style.display = 'block';
                } catch (error) {
                    console.error('Error analyzing photo:', error);
                    document.getElementById('photoLoadingSpinner').style.display = 'none';
                    showError('Error analyzing photo. Please try again.');
                }
            };

            img.src = URL.createObjectURL(window.selectedPhotoFile);
        }

        // ============================================
        // ANALYZE SYMPTOMS
        // ============================================
        function analyzeSymptoms() {
            if (selectedSymptoms.length === 0) {
                showError('Please select at least one symptom');
                return;
            }

            try {
                // Import and use disease-database.js functions
                // For now, we'll create a mock prediction
                let predictions = predictDiseasesLocal(selectedSymptoms);

                // Apply photo boost if photo analyzed
                if (photoAnalysisData && photoAnalysisData.success && photoAnalysisData.boost) {
                    predictions = predictions.map(pred => ({
                        ...pred,
                        confidence: Math.min(
                            parseFloat(pred.confidence) + photoAnalysisData.boost,
                            99
                        ).toFixed(1),
                        photoBoost: true
                    }));

                    predictions.sort((a, b) => parseFloat(b.confidence) - parseFloat(a.confidence));
                }

                displayPredictions(predictions);
            } catch (error) {
                console.error('Error analyzing symptoms:', error);
                showError('Error analyzing symptoms. Please try again.');
            }
        }

        // Local disease prediction (fallback)
        function predictDiseasesLocal(symptoms) {
            const diseases = {
                'Influenza': {
                    symptoms: ['fever', 'cough', 'sore_throat', 'fatigue', 'headache', 'body_ache', 'chills'],
                    remedies: ['Rest and sleep', 'Drink warm fluids', 'Use honey for cough', 'Take paracetamol for fever'],
                    urgency: 'MEDIUM',
                    whenToVisit: 'If symptoms persist for more than 7 days or difficulty breathing occurs'
                },
                'Common Cold': {
                    symptoms: ['runny_nose', 'cough', 'sore_throat', 'nasal_congestion', 'fatigue'],
                    remedies: ['Stay hydrated', 'Use saline nasal drops', 'Get adequate rest', 'Consume vitamin C'],
                    urgency: 'LOW',
                    whenToVisit: 'If symptoms persist for more than 10 days'
                },
                'Chickenpox': {
                    symptoms: ['fever', 'rash', 'blister', 'itching', 'fatigue', 'headache', 'body_ache'],
                    remedies: ['Keep blisters clean and dry', 'Apply calamine lotion', 'Avoid scratching', 'Rest adequately'],
                    urgency: 'MEDIUM',
                    whenToVisit: 'Immediately if high fever or signs of infection appear'
                },
                'Gastroenteritis': {
                    symptoms: ['nausea', 'vomiting', 'diarrhea', 'abdominal_pain', 'loss_of_appetite', 'fever'],
                    remedies: ['Stay hydrated with ORS', 'Eat bland foods', 'Avoid dairy and fatty foods', 'Rest'],
                    urgency: 'MEDIUM',
                    whenToVisit: 'If symptoms persist beyond 3 days or severe dehydration occurs'
                },
                'Migraine': {
                    symptoms: ['headache', 'nausea', 'dizziness', 'fatigue'],
                    remedies: ['Apply cold compress', 'Rest in dark room', 'Take prescribed medication', 'Avoid triggers'],
                    urgency: 'LOW',
                    whenToVisit: 'If headaches become frequent or severe'
                }
            };

            let predictions = [];

            for (const [disease, data] of Object.entries(diseases)) {
                const matchedSymptoms = symptoms.filter(s => data.symptoms.includes(s));
                if (matchedSymptoms.length > 0) {
                    const confidence = (matchedSymptoms.length / data.symptoms.length * 100).toFixed(1);
                    predictions.push({
                        name: disease,
                        confidence: confidence,
                        urgency: data.urgency,
                        matchedSymptoms: matchedSymptoms,
                        homeRemedy: data.remedies,
                        whenToVisit: data.whenToVisit,
                        photoBoost: false
                    });
                }
            }

            predictions.sort((a, b) => parseFloat(b.confidence) - parseFloat(a.confidence));
            return predictions.slice(0, 5);
        }

        // ============================================
        // DISPLAY PREDICTIONS
        // ============================================
        function displayPredictions(predictions) {
            const resultsDiv = document.getElementById('diseaseResults');

            if (predictions.length === 0) {
                resultsDiv.innerHTML = '<p style="color: #999;">No matching diseases found. Please select different symptoms.</p>';
                document.getElementById('resultsSection').classList.add('show');
                return;
            }

            resultsDiv.innerHTML = predictions.map((disease, index) => {
                const confidence = parseFloat(disease.confidence);
                let confidenceClass = 'confidence-low';
                if (confidence >= 80) confidenceClass = 'confidence-high';
                else if (confidence >= 60) confidenceClass = 'confidence-medium';

                let urgencyClass = 'urgency-low';
                if (disease.urgency === 'HIGH') urgencyClass = 'urgency-high';
                else if (disease.urgency === 'MEDIUM') urgencyClass = 'urgency-medium';

                return `
                    <div class="disease-card">
                        <div class="disease-header">
                            <span class="disease-name">${index + 1}. ${disease.name}</span>
                            <div>
                                <span class="confidence-badge ${confidenceClass}">${disease.confidence}% Confidence</span>
                                <span class="disease-urgency urgency-${urgencyClass.split('-')[1]}">${disease.urgency}</span>
                                ${disease.photoBoost ? '<span class="photo-boost-indicator">üì∏ Photo Confirmed</span>' : ''}
                            </div>
                        </div>
                        <div class="disease-details">
                            <h4>Matched Symptoms:</h4>
                            <ul>
                                ${disease.matchedSymptoms.map(s => `<li>${s.replace(/_/g, ' ')}</li>`).join('')}
                            </ul>

                            <h4>Home Remedies:</h4>
                            <ul>
                                ${disease.homeRemedy.map(r => `<li>${r}</li>`).join('')}
                            </ul>

                            <h4>When to Visit Doctor:</h4>
                            <p>${disease.whenToVisit}</p>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('resultsSection').classList.add('show');
            window.scrollTo({ top: document.getElementById('resultsSection').offsetTop - 100, behavior: 'smooth' });
        }

        // ============================================
        // ERROR HANDLING
        // ============================================
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        // ============================================
        // BUTTON EVENT LISTENERS
        // ============================================
        function setupButtonListeners() {
            document.getElementById('analyzeBtn').addEventListener('click', analyzeSymptoms);
            document.getElementById('clearBtn').addEventListener('click', clearAll);
            document.getElementById('analyzePhotoBtn').addEventListener('click', analyzePhotoWithTensorFlow);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            setupCheckboxListeners();
            setupPhotoUpload();
            setupButtonListeners();
            console.log('‚úÖ Symptom Checker initialized');
        });
    </script>
</body>
</html>
